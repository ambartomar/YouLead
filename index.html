<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>YouTube Lead Studio Advanced</title>
  <style>
    body{margin:0;font-family:'Inter',sans-serif;background:linear-gradient(135deg,#0f172a,#1e293b);color:#f8fafc;height:100vh;overflow:hidden;}
    header{padding:14px 20px;display:flex;gap:10px;align-items:center;background:rgba(255,255,255,0.05);backdrop-filter:blur(12px);border-bottom:1px solid rgba(255,255,255,0.1);}
    header input,header button{padding:10px 14px;border-radius:10px;border:none;font-size:14px;transition:all .3s ease;}
    header input{flex:1;background:rgba(255,255,255,0.08);color:#fff;}
    header input::placeholder{color:#94a3b8;}
    header button{background:linear-gradient(90deg,#ef4444,#f97316);color:#fff;cursor:pointer;font-weight:600;box-shadow:0 4px 12px rgba(239,68,68,0.4);}
    header button:hover{transform:translateY(-2px) scale(1.02);}
    main{display:flex;height:calc(100vh - 60px);}
    aside{width:40%;border-right:1px solid rgba(255,255,255,0.1);overflow-y:auto;padding:16px;background:rgba(255,255,255,0.02);backdrop-filter:blur(10px);}
    section{flex:1;position:relative;overflow:hidden;}
    table{width:100%;border-collapse:collapse;margin-top:16px;}
    th,td{padding:10px;border-bottom:1px solid rgba(255,255,255,0.08);}
    th{background:rgba(255,255,255,0.05);text-align:left;}
    tr{transition:background .2s,transform .2s;}
    tr:hover{background:rgba(255,255,255,0.1);cursor:pointer;transform:scale(1.01);}
    .filters{display:grid;grid-template-columns:repeat(auto-fill,minmax(140px,1fr));gap:8px;margin-top:10px;}
    .filters input,.filters select{padding:8px;border-radius:8px;border:none;background:rgba(255,255,255,0.08);color:#fff;}
    #status{margin-top:10px;font-size:14px;color:#94a3b8;}
    #loader{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);display:none;flex-direction:column;align-items:center;}
    .spinner{width:40px;height:40px;border:4px solid rgba(255,255,255,0.3);border-top:4px solid #ef4444;border-radius:50%;animation:spin 1s linear infinite;}
    @keyframes spin{to{transform:rotate(360deg);}}
    /* side panel */
    #sidePanel{position:absolute;top:0;right:-400px;width:400px;height:100%;background:rgba(30,41,59,0.95);backdrop-filter:blur(20px);padding:20px;overflow-y:auto;transition:right .4s ease;box-shadow:-4px 0 20px rgba(0,0,0,.4);}
    #sidePanel.open{right:0;}
    .close-btn{background:#ef4444;border:none;padding:6px 10px;border-radius:6px;color:#fff;cursor:pointer;float:right;}
    .channel-header{text-align:center;margin-bottom:20px;}
    .channel-header img{border-radius:50%;width:80px;height:80px;}
    .channel-header h2{margin:10px 0 5px;}
    .channel-header p{color:#94a3b8;font-size:14px;}
    .detail{margin:10px 0;}
    .detail strong{color:#fbbf24;}
    .btn{display:inline-block;margin-top:8px;padding:8px 12px;background:#3b82f6;border-radius:8px;color:#fff;text-decoration:none;font-size:14px;transition:background .2s;}
    .btn:hover{background:#2563eb;}
  </style>
</head>
<body>
<header>
  <input id="query" placeholder="Search query (e.g. Cod one chest challenge)"/>
  <button onclick="searchYouTube()">Search</button>
  <button onclick="exportCSV()">Export CSV</button>
</header>
<main>
  <aside>
    <div class="filters">
      <input id="minSubs" placeholder="> Min Subs" type="number"/>
      <input id="maxSubs" placeholder="< Max Subs" type="number"/>
      <select id="verified"><option value="any">Any</option><option value="true">Verified</option><option value="false">Not Verified</option></select>
      <select id="region"><option value="">Region Any</option><option value="US">US</option><option value="IN">India</option><option value="GB">UK</option><option value="CA">Canada</option></select>
      <select id="duration"><option value="">Any Duration</option><option value="short">Short (<4m)</option><option value="medium">Medium (4–20m)</option><option value="long">Long (>20m)</option></select>
      <select id="upload"><option value="">Any Time</option><option value="hour">Last Hour</option><option value="today">Today</option><option value="week">This Week</option><option value="month">This Month</option></select>
      <select id="order"><option value="relevance">Relevance</option><option value="date">Date</option><option value="viewCount">Views</option><option value="rating">Rating</option></select>
      <select id="definition"><option value="">Any Quality</option><option value="high">HD</option><option value="standard">SD</option></select>
      <select id="safe"><option value="">Safe Any</option><option value="none">None</option><option value="moderate">Moderate</option><option value="strict">Strict</option></select>
    </div>
    <div id="status">Ready.</div>
    <table><thead><tr><th>Channel</th><th>Subs</th><th>Verified</th></tr></thead><tbody id="results"></tbody></table>
  </aside>
  <section>
    <div id="loader"><div class="spinner"></div><p>Loading…</p></div>
    <div id="sidePanel">
      <button class="close-btn" onclick="closePanel()">X</button>
      <div id="panelContent"></div>
    </div>
  </section>
</main>

<script>
const apiKey="AIzaSyBo5wWMC5T5lemycWNqtfs2_SAjApsLuFA";
let leads=[];

async function searchYouTube(){
  const query=document.getElementById('query').value.trim();
  if(!query){alert('Enter search query');return;}
  leads=[];
  document.getElementById('results').innerHTML='';
  setStatus("Searching…");showLoader(true);

  // collect filters
  const region=document.getElementById('region').value;
  const duration=document.getElementById('duration').value;
  const upload=document.getElementById('upload').value;
  const order=document.getElementById('order').value;
  const definition=document.getElementById('definition').value;
  const safe=document.getElementById('safe').value;

  try{
    let url=`https://www.googleapis.com/youtube/v3/search?part=snippet&type=video&q=${encodeURIComponent(query)}&maxResults=30&order=${order}&key=${apiKey}`;
    if(region) url+=`&regionCode=${region}`;
    if(duration) url+=`&videoDuration=${duration}`;
    if(upload){ url+=`&publishedAfter=${getTimeFilter(upload)}`; }
    if(definition) url+=`&videoDefinition=${definition}`;
    if(safe) url+=`&safeSearch=${safe}`;
    const res=await fetch(url);const data=await res.json();
    if(!data.items){setStatus("No results.");showLoader(false);return;}
    const uniqueChannels=new Map();
    for(const item of data.items){
      const title=item.snippet.title.toLowerCase();
      const desc=item.snippet.description.toLowerCase();
      if(title.includes("shorts")||desc.includes("shorts")) continue;
      const channelId=item.snippet.channelId;
      if(!uniqueChannels.has(channelId)){
        uniqueChannels.set(channelId,item.snippet.channelTitle);
      }
    }
    for(const [channelId,channelTitle] of uniqueChannels){
      const chRes=await fetch(`https://www.googleapis.com/youtube/v3/channels?part=statistics,snippet,brandingSettings&id=${channelId}&key=${apiKey}`);
      const chData=await chRes.json();const ch=chData.items&&chData.items[0];if(!ch) continue;
      const subs=ch.statistics.hiddenSubscriberCount?0:parseInt(ch.statistics.subscriberCount);
      const verified=ch.snippet.customUrl?"Yes":"No";
      leads.push({id:channelId,channel:channelTitle,subs,verified,avatar:ch.snippet.thumbnails.default.url,
                  banner:ch.brandingSettings.image?.bannerExternalUrl,desc:ch.snippet.description,
                  country:ch.snippet.country||"N/A",views:ch.statistics.viewCount,videoCount:ch.statistics.videoCount,created:ch.snippet.publishedAt});
    }
    setStatus(`Found ${leads.length} channels.`);showLoader(false);renderTable();
  }catch(e){console.error(e);setStatus("Error.");showLoader(false);}
}

function getTimeFilter(upload){
  const now=new Date();
  if(upload==="hour"){now.setHours(now.getHours()-1);}
  else if(upload==="today"){now.setHours(0,0,0,0);}
  else if(upload==="week"){now.setDate(now.getDate()-7);}
  else if(upload==="month"){now.setMonth(now.getMonth()-1);}
  return now.toISOString();
}

function renderTable(){
  const tbody=document.getElementById('results');tbody.innerHTML='';
  const minSubs=parseInt(document.getElementById('minSubs').value)||0;
  const maxSubs=parseInt(document.getElementById('maxSubs').value)||Infinity;
  const verifiedFilter=document.getElementById('verified').value;
  let filtered=leads.filter(l=>{
    if(l.subs<minSubs) return false;
    if(l.subs>maxSubs) return false;
    if(verifiedFilter==='true'&&l.verified!=="Yes") return false;
    if(verifiedFilter==='false'&&l.verified!=="No") return false;
    return true;
  });
  if(filtered.length===0){tbody.innerHTML="<tr><td colspan='3'>No channels match filters.</td></tr>";return;}
  filtered.forEach(l=>{
    const tr=document.createElement('tr');
    tr.innerHTML=`<td><img class='avatar' src='${l.avatar}' style='width:24px;height:24px;border-radius:50%;margin-right:6px;'>${l.channel}</td><td>${l.subs}</td><td>${l.verified}</td>`;
    tr.onclick=()=>openPanel(l);
    tbody.appendChild(tr);
  });
}

function openPanel(l){
  const panel=document.getElementById('sidePanel');panel.classList.add('open');
  const c=document.getElementById('panelContent');
  c.innerHTML=`<div class="channel-header">
    ${l.banner?`<img src="${l.banner}=w1060-fcrop64=1,00005a57ffffa5a8-k-c0xffffffff-no-nd-rj" style="width:100%;border-radius:12px;margin-bottom:10px;">`:''}
    <img src="${l.avatar}"><h2>${l.channel}</h2><p>${l.desc||'No description'}</p>
  </div>
  <div class="detail"><strong>Subscribers:</strong> ${l.subs}</div>
  <div class="detail"><strong>Total Views:</strong> ${l.views}</div>
  <div class="detail"><strong>Videos:</strong> ${l.videoCount}</div>
  <div class="detail"><strong>Country:</strong> ${l.country}</div>
  <div class="detail"><strong>Created:</strong> ${new Date(l.created).toDateString()}</div>
  <div class="detail"><strong>Channel ID:</strong> ${l.id} <button class="btn" onclick="copyId('${l.id}')">Copy</button></div>
  <a href="https://youtube.com/channel/${l.id}" target="_blank" class="btn">Visit Channel</a>
  `;
}

function closePanel(){document.getElementById('sidePanel').classList.remove('open');}

function exportCSV(){
  if(leads.length===0){alert('No data to export');return;}
  let csv='Channel,Subscribers,Verified,Views,Videos,Country,Created,ChannelId\n';
  leads.forEach(l=>{csv+=`${l.channel},${l.subs},${l.verified},${l.views},${l.videoCount},${l.country},${l.created},${l.id}\n`;});
  const blob=new Blob([csv],{type:'text/csv'});const url=URL.createObjectURL(blob);
  const a=document.createElement('a');a.href=url;a.download='youtube_channels.csv';a.click();
}

function copyId(id){navigator.clipboard.writeText(id);alert("Channel ID copied!");}
function setStatus(m){document.getElementById('status').innerText=m;}
function showLoader(b){document.getElementById('loader').style.display=b?'flex':'none';}
</script>
</body>
</html>
